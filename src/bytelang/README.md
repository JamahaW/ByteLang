# **BYTELANG**

### Типы файлов

- **.bls** — (ByteLang Source) - исходный байткод

- **.blc** — (ByteLang Compiled) - скомпилированный байткод

- **.blp** — (ByteLang Package) - пакет инструкций\
  инструкции объявляются следующим образом:
  `<name> <T> <T*> ...`, где
    - name - уникальный идентификатор
    - T - разрешённый тип данных*
    - Указатель обозначается как T*\
      Примеры:\
    - `exit u16`
    - `print i32*`
    - `move i32 i32`

  Разрешенные типы данных:\
  Тип ByteLang - тип C++
    - `bool - boolean`
    - `char - char`
    - `i8 - int8_t`
    - `u8 - uint8_t`
    - `i16 - int16_t`
    - `u16 - uint16_t`
    - `i32 - int32_t`
    - `u32 - uint32_t`
    - `i64 - int64_t`
    - `u64 - uint64_t`
    - `f32 - float`
    - `f64 - double`

- **json** (Параметры платформы)
    - `` - Размер в байтах указателя программы, ограничивает максимальны размер программы
    - `` - Размер в байтах указателя инструкции, определяет максимальное количество инструкций
    - `` - Размер в байтах указателя кучи определяет, максимальный размер кучи
    - `` - Максимальный размер скомпилированной программы, опционально, по умолчанию нет ограничений
    - `` - описание пакета, опционально

### Синтаксис

- каждое выражение должно быть записаны в отдельной строке.
- Разделителем является пробел
- Для добавления комментариев используется символ «#».\
  Пример: `# Это комментарий`

### Директивы

Директивы используются для операций над кодом во время компиляции

- `platform <name>` компиляция под конфигурацию платформы.\
  Пример: `.platform <test> ; компиляция для платформы test`
    - Вызывается однократно
    - В аргументах компилятора нужно указать путь поиска

- `package <name>` использовать пакет инструкций ByteLang.\
  Пример: `.package <test> ; использовать инструкции из пакета test`
    - Вызывается однократно
    - В аргументах компилятора нужно указать путь для поиска

- `heap <heap_size>` выделить память для кучи.\
  Пример: `.heap 128 ; область "куча" занчивается на 128 байте`
    - Вызывается однократно
    - heap_size < 2^(heap_ptr * 8) в текущей конфигурации

- `ptr <T> <name> <index>` объявить указатель.\
  Пример: `.ptr i32 abc 12345 ; объявить указатель abc типав i32 с значением 12345`
    - T должен соответствовать одному из существующих типов
    - повторное объявление с существующим идентификатором недопустимо
    - index >= heap_ptr
    - значение value должно быть допустимым для типа данных указателя
    - Разрешается использовать адресную арифметику, при условии, что есть один и только один операнд типа
      указателя,
      и все остальные операнды - константы

- `inline <cmd>` встроить в код последнее значение аргумента.\
  Пример: `.inline print 12345 ; объявлена инструкция print(i16*)`
    - последний аргумент должен быть указателем
    - значение будет встроено вместо указателя
    - Устанавливает старший бит индекса инструкции в 1 (inline_flag)

- `def <name> <value>` Объявить макро константу.\
  Пример: `.def TIMER_MAX_MS 1200`
    - повторное объявление с существующим идентификатором недопустимо
    - Можно указывать выражение, но запрещается указывать данный идентификатор в операндах
    - В выражении в качестве операндов могут быть только константы

### Инструкции

Формат команды: `<name> <arg1> <arg2> ...`

```
.package servos ; допустим, есть инструкция set_servo@45(u8, u8*)

.platform arduino ; используемая платформа имеет следующие параметры
; heap_ptr = 1
; instruction_index = 1
```

Пример с константным аргументом и переменной:

```
.heap 1             ; выделяем кучу размером 1 байт под переменную
.ptr u8 angle 1     ; угол поворота
.set angle 90       
set_servo 3 angle   ; вызываем инструкцию set_servo с аргументами 3, angle
```

Скомпилированная программа будет следующим образом:

```
2   ; (u8)начальное значение счётчика инструкций

heap: 1 byte
90  ; значение (u8)angle

code:
45  ; инструкция set_servo
3   ; аргумент константное значение
1   ; аргумент указатель (u8*)angle
```

Пример с встроенной переменной

```
.inline set_servo 3 90
```

Результат компиляции

```
1  ; (u8)начальное значение счётчика инструкций

heap: 0 byte

code:
173 ; инструкция set_servo, inline_flag=1
3   ; аргумент константное значение
90  ; аргумент значение (u8)
```

### Метки

Метки используются для обозначения определенных точек в коде.\
Формат метки: `<name>:`\
Пример:
`mark:`
